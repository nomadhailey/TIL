# 22. Development Mode & Production Mode

* 각 환경에 따라 웹팩의 빌드과정을 다르게 구분 짓기 위해 웹팩 merge를 통해 각 환경에 대한 파일을 따로 만들고 스크립트 실행

* webpack-merge 설치

```bash
npm i webpack-merge -D
```

* 3개의 설정 파일 생성 : 각 설정 파일의 모드값을 적용한 상태로 진행

  1) webpack.common.js : 환경설정 공통 부분 담당 파일

  2) webpack.dev.js : 개발 모드 담당 파일

  3) webpack.prod.js : 프로덕션 모드 담당 파일

```json
// package.json
// webpack 명령어 실행 시 config라는 플래그로 설정 파일을 지정할 수 있는데, 이 플래그로 개발환경모드인 dev와 production환경 모드인 build로 구분 지음
 "scripts": {
    "dev": "webpack --config webpack.dev.js", // 명령어 : npm run dev
    "build": "webpack --config webpack.prod.js" // 명령어 : npm run build
  },
```



* **defineplugin**

  * 웹팩의 빌드 진행 시 특정한 상수값을 만들어서 모듈들이 이 상수값을 어디서든 사용할 수 있도록 해줌. 예를 들어 현재 빌드되고 있는 모드가 프로덕션인지 아닌지 알고 싶으면 이 플러그인을 통해 모든 모듈에서 사용될 수 있도록 설정할 수 있음.
  * 웹팩 모듈 내부에 있는 플러그인이므로 따로 설치 필요 x

* ```json
  // package.json
  // NODE_ENV : 노드 환경에서 process.env라는 객체에 담긴 node env에 접근할 수 있음
  "scripts": {
      "dev": "NODE_ENV=DEVELOPMENT webpack --config webpack.dev.js",
      "build": "NODE_ENV=PRODUCTION webpack --config webpack.prod.js"
    },
  ```



# 23. Development Mode & Production Mode - 2 & 24. Development Mode & Production Mode - 3



###개발모드에 관한 환경 세팅

* 개발모드를 위해 웹팩에서 특별한 로컬 서버 지원해주는데 이 서버를 사용하기 위해서는 webpack-dev-server 모듈 설치 필요

* **webpack-dev-server**

  ```bash
  # 설치
  npm i -D webpack-dev-server 
  # 실행_명령어를 통한 실행
  ./node_modules/.bin/webpack-dev-server --config webpack.dev.js
  ```

  * 명령어가 아닌 package.json에 등록하여 webpack-dev-server 실행하기

  ```json
  // package.json
   "scripts": {
      "start": "NODE_ENV=DEVELOPMENT webpack-dev-server --config webpack.dev.js",
      "dev": "NODE_ENV=DEVELOPMENT webpack --config webpack.dev.js",
      "build": "NODE_ENV=PRODUCTION webpack --config webpack.prod.js"
    },
  ```

  * webpack-dev-server를 통해 빌드된 결과물은 메모리상에 있기 때문에 직접 파일을 쓰고 지우는 방식보다 더 빠름. 수정된 결과물도 메모리상에 있는 결과값과 비교해서 바로 수정이 됨. 파일을 지우고 쓰고 하는 반복 과정 없이 개발하기 때문에 수정사항에 대한 피드백을 훨씬 빠르게 받을 수 있는 환경

  * webpack-dev-server는 파일 프로토콜이 아닌 형태로 제공됨. 기존에 빌드된 파일을 확인하기 위해서는 dist폴더에서 생성된 index.html파일을 직접 열어 확인했으나, dev-server를 이용하면 server가 띄워져 있어 http url로 접근하기 때문에 접근하기가 훨씬 쉽고, 실제 웹서비스에서 어떻게 이용될지  생각할 수 있는 환경이 제공됨

  * **webpack-dev-server에서 제공하는 옵션들**

    * watch 옵션 : 파일 변화를 감지했을 때 다시 build를 시작
    * history API Fallback  : 라우팅과 관련된 키로 특정 라우팅을 지정했을 때 우리가 제공하지 않는 라우팅으로 이동을 할 경우, 예외적인 처리를 하거나 특정한 라우팅은 특정한 html문서로 이동시킬 수 있게 할 수 있음
      * SPA와 같이 html5 history API를 사용하는 경우에 설정
      * `historyApiFallback : true` : 예를 들어 localhost:8080/hello와 같이 없는 경로(/hello)로 접근 시, 이 값이 true로 설정되어 있으면 index.html 환경으로 이동시켜줌
      * `historyApiFallback : { rewrites:[  {from:/^\/subpage$/, to:'subpage.html'} ] }`: 여러가지 라우팅 설정을 지정할 수 있고 특정 지점으로 이동시킬 수 있음

    ```javascript
    // webpack.dev.js
    const { merge } = require("webpack-merge");
    const common = require("./webpack.common");
    
    const config = {
      mode: "development",
      devServer:{
          // historyApiFallback : true 
          historyApiFallback : {
              rewrites:[
                  {from:/^\/subpage$/, to:'subpage.html'}, 
              ]
          }
      }
    };
    
    module.exports = merge(common, config);
    ```

    * open 옵션 : 최초로 웹팩과 관련된 스크립트를 실행 했을 때  기본 브라우저가 자동으로 함께 실행